<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>User Directory | Admin Console</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600&family=Plus+Jakarta+Sans:wght@500;600;700&display=swap"
        rel="stylesheet">

    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">

    <style>
        :root {
            --font-sans: 'Inter', system-ui, -apple-system, sans-serif;
            --font-heading: 'Plus Jakarta Sans', system-ui, sans-serif;
            --primary-gradient: linear-gradient(135deg, #0f172a 0%, #334155 100%);
            /* Admin Slate */
            --bg-color: #f1f5f9;
        }

        body {
            font-family: var(--font-sans);
            background-color: var(--bg-color);
            color: #334155;
        }

        h1,
        h2,
        h3,
        h4,
        h5,
        h6,
        .navbar-brand {
            font-family: var(--font-heading);
        }

        .navbar {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(16px);
            border-bottom: 1px solid rgba(226, 232, 240, 0.8);
        }

        .brand-icon {
            width: 40px;
            height: 40px;
            background: var(--primary-gradient);
            color: white;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
        }

        .card {
            border: none;
            border-radius: 16px;
            background: white;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05);
        }

        .avatar-circle {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: 600;
            font-size: 0.875rem;
        }
    </style>
</head>

<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg sticky-top mb-5">
        <div class="container">
            <a class="navbar-brand d-flex align-items-center gap-3" href="{{ url_for('admin.dashboard') }}">
                <div class="brand-icon"><i class="bi bi-shield-lock-fill"></i></div>
                <div class="d-flex flex-column">
                    <span class="fw-bold fs-6 text-dark">Admin Console</span>
                    <span class="text-muted" style="font-size: 0.75rem;">User Management</span>
                </div>
            </a>

            <div class="ms-auto d-flex align-items-center gap-3">
                <div class="text-end d-none d-sm-block">
                    <div class="fw-bold small text-dark" id="headerName">Admin User</div>
                    <div class="text-muted" style="font-size: 0.7rem;" id="headerRole">Administrator</div>
                </div>
                <div class="rounded-circle bg-dark text-white d-flex align-items-center justify-content-center shadow-sm"
                    style="width: 40px; height: 40px;" id="headerAvatar">
                    <i class="bi bi-person-fill"></i>
                </div>
            </div>
        </div>
    </nav>

    <main class="container mb-5">
        <div class="row mb-4 align-items-end">
            <div class="col-md-6">
                <h2 class="fw-bold text-dark mb-2">User Directory</h2>
                <p class="text-muted mb-0">Browse and manage all registered users.</p>
            </div>
            <div class="col-md-6 text-md-end">
                <!-- Toolbar -->
                <div class="d-flex gap-2 justify-content-md-end mt-3 mt-md-0">
                    <input type="text" id="searchInput" class="form-control w-auto" placeholder="Search users..."
                        onkeyup="handleSearch()">
                    <div class="btn-group">
                        <button class="btn btn-outline-secondary active filter-btn"
                            onclick="filterUsers('all', this)">All</button>
                        <button class="btn btn-outline-secondary filter-btn"
                            onclick="filterUsers('active', this)">Active</button>
                        <button class="btn btn-outline-secondary filter-btn"
                            onclick="filterUsers('inactive', this)">Inactive</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="card p-4">
            <div class="table-responsive">
                <table class="table table-hover align-middle">
                    <thead class="bg-light">
                        <tr>
                            <th class="border-0 text-muted small fw-bold text-uppercase">User</th>
                            <th class="border-0 text-muted small fw-bold text-uppercase">Department</th>
                            <th class="border-0 text-muted small fw-bold text-uppercase">Role</th>
                            <th class="border-0 text-muted small fw-bold text-uppercase">Status</th>
                            <th class="border-0 text-muted small fw-bold text-uppercase">Joined</th>
                        </tr>
                    </thead>
                    <tbody id="usersTableBody">
                        <!-- Data populated by JS -->
                    </tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div class="d-flex justify-content-between align-items-center mt-4">
                <p class="text-muted small mb-0">
                    Showing <span class="fw-bold" id="showingCount">0-0</span> of <span class="fw-bold"
                        id="totalCount">0</span> users
                </p>
                <div class="btn-group">
                    <button class="btn btn-sm btn-outline-secondary" onclick="changePage(-1)"
                        id="prevBtn">Previous</button>
                    <button class="btn btn-sm btn-outline-secondary" onclick="changePage(1)" id="nextBtn">Next</button>
                </div>
            </div>
        </div>

    </main>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // ============================================
        // ADMIN ACCESS CONTROL
        // ============================================
        function checkAdminAccess() {
            const userData = localStorage.getItem('user');
            if (!userData) {
                window.location.href = "{{ url_for('auth.login') }}";
                return false;
            }
            const user = JSON.parse(userData);
            if (user.role !== 'Admin' && user.role !== 'admin') {
                alert('â›” Access Denied! Admins only.');
                window.location.href = "{{ url_for('common.profile') }}";
                return false;
            }
            return true;
        }

        // Data
        const usersData = [
            { id: 1, name: 'Aradhya N', email: 'aradhya.N@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-01-15' },
            { id: 2, name: 'Manoj G', email: 'manoj.G@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-01-20' },
            { id: 3, name: 'Punith Raj', email: 'punith.raj@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-02-01' },
            { id: 4, name: 'Shravan S', email: 'shravan.s@college.edu', department: 'Computer Science', role: 'TA', status: 'active', joined: '2023-08-10' },
            { id: 5, name: 'Girish K', email: 'girish.k@college.edu', department: 'Computer Science', role: 'Student', status: 'inactive', joined: '2024-01-25' },
            { id: 6, name: 'Madan Sunil Chimal', email: 'madan.sunil.chimal@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-03-05' },
            { id: 7, name: 'Shruthi M', email: 'shruthi.m@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-02-15' },
            { id: 8, name: 'Syed Mushraf', email: 'syed.mushraf@college.edu', department: 'Computer Science', role: 'Student', status: 'pending', joined: '2024-03-20' },
            { id: 9, name: 'Dr.Bhavani H ', email: 'bhavani.h @college.edu', department: 'Computer Science', role: 'Professor', status: 'active', joined: '2020-06-01' },
            { id: 10, name: 'Kavya H M', email: 'kavya.h.m@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-01-10' },
            { id: 11, name: 'Mohit J', email: 'mohit.j@college.edu', department: 'Computer Science', role: 'Student', status: 'inactive', joined: '2023-08-15' },
            { id: 12, name: 'Neha A', email: 'neha.a@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-02-28' },
            { id: 13, name: 'Siddharth R', email: 'sid.rao@college.edu', department: 'Computer Science', role: 'Lab Assistant', status: 'active', joined: '2022-07-01' },
            { id: 14, name: 'Tanvi S', email: 'tanvi.shah@college.edu', department: 'Computer Science', role: 'Student', status: 'active', joined: '2024-01-18' },
            { id: 15, name: 'Varun M', email: 'varun.m@college.edu', department: 'Computer Science', role: 'Student', status: 'pending', joined: '2024-03-25' },
        ];

        let filteredUsers = [...usersData];
        let currentPage = 1;
        const usersPerPage = 10;

        function initializePage() {
            if (!checkAdminAccess()) return;

            const userData = localStorage.getItem('user');
            if (userData) {
                const user = JSON.parse(userData);
                document.getElementById('headerName').textContent = user.name || 'Admin';
                document.getElementById('headerRole').textContent = user.role || 'Admin';
                // document.getElementById('headerAvatar') can be generic icon
            }
            renderUsers();
        }

        function getInitials(name) {
            return name.split(' ').map(n => n[0]).join('').toUpperCase().substring(0, 2);
        }

        function getAvatarStyle(id) {
            const colors = ['#3b82f6', '#8b5cf6', '#10b981', '#f59e0b', '#ef4444', '#ec4899'];
            return colors[id % colors.length];
        }

        function renderUsers() {
            const tbody = document.getElementById('usersTableBody');
            const start = (currentPage - 1) * usersPerPage;
            const end = start + usersPerPage;
            const pageUsers = filteredUsers.slice(start, end);

            tbody.innerHTML = pageUsers.map(user => {
                let statusBadge = 'bg-secondary';
                if (user.status === 'active') statusBadge = 'bg-success';
                if (user.status === 'inactive') statusBadge = 'bg-danger';
                if (user.status === 'pending') statusBadge = 'bg-warning text-dark';

                return `
                <tr>
                  <td>
                    <div class="d-flex align-items-center gap-3">
                      <div class="avatar-circle shadow-sm" style="background-color: ${getAvatarStyle(user.id)}">
                        ${getInitials(user.name)}
                      </div>
                      <div class="d-flex flex-column">
                        <span class="fw-bold text-dark">${user.name}</span>
                        <span class="text-muted small">${user.email}</span>
                      </div>
                    </div>
                  </td>
                  <td>${user.department}</td>
                  <td><span class="badge bg-light text-dark border">${user.role}</span></td>
                  <td><span class="badge ${statusBadge}">${user.status.toUpperCase()}</span></td>
                  <td class="text-muted small">${formatDate(user.joined)}</td>
                </tr>
              `;
            }).join('');

            document.getElementById('showingCount').textContent = `${start + 1}-${Math.min(end, filteredUsers.length)}`;
            document.getElementById('totalCount').textContent = filteredUsers.length;
            document.getElementById('prevBtn').disabled = currentPage === 1;
            document.getElementById('nextBtn').disabled = end >= filteredUsers.length;
        }

        function formatDate(dateStr) {
            return new Date(dateStr).toLocaleDateString('en-IN', { year: 'numeric', month: 'short', day: 'numeric' });
        }

        function handleSearch() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            filteredUsers = usersData.filter(user =>
                user.name.toLowerCase().includes(searchTerm) ||
                user.email.toLowerCase().includes(searchTerm)
            );
            currentPage = 1;
            renderUsers();
        }

        function filterUsers(status, btn) {
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.remove('active', 'btn-secondary'));
            document.querySelectorAll('.filter-btn').forEach(b => b.classList.add('btn-outline-secondary'));

            btn.classList.remove('btn-outline-secondary');
            btn.classList.add('btn-secondary', 'active'); // Bootstrap active style

            if (status === 'all') filteredUsers = [...usersData];
            else filteredUsers = usersData.filter(user => user.status === status);
            currentPage = 1;
            renderUsers();
        }

        function changePage(direction) {
            currentPage += direction;
            renderUsers();
        }

        window.onload = initializePage;
    </script>
</body>

</html>